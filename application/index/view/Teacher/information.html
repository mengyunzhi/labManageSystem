{extend name="Teacher/nav"}
{block name="title"}个人信息{/block}
{block name="content"}
<div style="margin: 100px 600px;">
    <form class="form-inline" action="{:url('saveInformation')}" method="post">
        <div class="form-group" style="padding-top: 50px">
            <label >姓名：</label>
            <input type="hidden" name="id" value="{$teacher->getData('id')}">
            <input type="text" class="form-control" name="name" value="{$teacher->name}">
        </div>
        <br>
        <div class="form-group" style="margin-left: 5px;padding: 50px 0">
            <label>身份:</label>
            <label>老师</label>
            <hr>

            <!--选择所教的班级-->
            <div class="form-group">
                <button type="button" class="btn btn-primary " data-toggle="modal" data-target="#addKlass">
                    <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
                    添加班级
                </button>
                <!--//删除班级的按钮-->
                <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#deleteKlass">
                    <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
                    删除班级
                </button>
                <br><br>
                <label>所教班级：</label><br>
                {volist name="tcolleges" id="College"}
                <label>{$College->name}:</label><br>
                <div>
                    {volist name="tmajors" id="Major"}
                    <div {neq name="$Major->college_id" value="$College->id" } hidden="hidden" {/neq}>
                    <div>
                        {volist name="tgrades" id="Grade"}
                        <div {neq name="$Grade->major_id" value="$Major->id" } hidden="hidden" {/neq}>
                        <div>
                            {volist name="tklass" id="Klass"}
                            <div {neq name="$Klass->grade_id" value="$Grade->id" } hidden="hidden" {/neq}>
                            &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
                            &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
                            {$Klass->name}
                            </div><br>
                            {/volist}
                        </div>
                        </div>
                        {/volist}
                    </div>
                    </div>
                    {/volist}
                </div>
            {/volist}
        </div>
    </div>
<hr>

<!--//展示所教的课程-->
<div class="form-group">
    <!--//添加课程的按钮-->
    <button type="button" class="btn btn-primary " data-toggle="modal" data-target="#addCourse">
        <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
        添加课程
    </button>
    <!--//删除课程的按钮-->
    <button type="button" class="btn btn-primary " data-toggle="modal" data-target="#deleteCourse">
        <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
        删除课程
    </button>
    <br><br>
    <label>所教课程：</label><br>
    {volist name="courses" id="Course"}
    <label>
        &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
        &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
        {$Course->name}
    </label><br>
    {/volist}
</div>
<br><br><br>
<button type="submit" class="btn btn-primary" style="margin-left: 100px;">保存</button>
</form>
</div>
<!--增加课程的表单-->
<div class="modal fade" id="addCourse" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <form action="{:url('addCourse')}" class="form-inline" method="post">
                <div class="modal-body">
                    <label>课程名称:</label>
                    <input name="newCourseName" placeholder="请输入要增加的课程名">
                    <input type="hidden" name="teacherId" value="{$teacher->id}" class="form-control">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <button type="submit" class="btn btn-primary">保存</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!--删除课程的表单-->
<form action="{:url('deleteCourse')}" method="post">
    <div class="modal fade" id="deleteCourse" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-body">
                    <label>课程名称:</label>
                    <br>
                    {volist name="courses" id="Course" key="key"}
                    <input type="checkbox" value="{$Course->id}" name="ids[{$key}]">
                    <label>{$Course->name}</label><br>
                    {/volist}
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <button type="submit" class="btn btn-primary">确定</button>
                </div>
            </div>
        </div>
    </div>
</form>

<!--添加班级-->
<form action="{:url('addKlass')}" method="post">
    <div class="modal fade bs-example-modal-lg" id="addKlass" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog modal-lg " role="document">
            <div class="modal-content">
                <div class="modal-body">
                    <br>
                    <p id="major1" class="hide">1</p>
                    <p id="grade1" class="hide">1</p>
                    <p id="klass1" class="hide">1</p>

                    <div class="col-md-3 row">
                        <label class="col-md-4 select_label">学院</label>
                        <div class="col-md-8">
                            <select id="college" class="form-control" onclick="getMajor()">
                                {volist name="colleges" id = "College"}
                                <option value="{$College->id}">
                                    {$College->name}
                                </option>
                                {/volist}
                            </select>
                        </div>
                    </div>
                    <div class="col-md-3 row">
                        <label class="col-md-4 select_label">专业</label>
                        <div class="col-md-8">
                            <select id="major" class="form-control" onclick="getGrade()">
                                <option>
                                </option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-3 row">
                        <label class="col-md-4 select_label">年级</label>
                        <div class="col-md-8">
                            <select id="grade" class="form-control" onclick="getKlass()">
                                <option>
                                </option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-3 row">
                        <label class="col-md-4 select_label">班级</label>
                        <div class="col-md-8">
                            <select id="aklass" class="form-control" onclick="getKlassId()">
                                <option>
                                </option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <button type="submit" class="btn btn-primary">确定</button>
                </div>
            </div>
        </div>
    </div>
</form>

<!--删除班级-->
<form action="{:url('deleteKlass')}" method="post">
    <input type="hidden" value="{$teacher->id}" name="teacherId">
    <div class="modal fade" id="deleteKlass" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-body">
                    {volist name="tcolleges" id="College"}
                    <label>{$College->name}:</label><br>
                    <div>
                        {volist name="tmajors" id="Major"}
                        <div {neq name="$Major->college_id" value="$College->id" } hidden="hidden" {/neq}>
                        <div>
                            {volist name="tgrades" id="Grade"}
                            <div {neq name="$Grade->major_id" value="$Major->id" } hidden="hidden" {/neq}>
                            <div>
                                {volist name="tklass" id="Klass"}
                                <div {neq name="$Klass->grade_id" value="$Grade->id" } hidden="hidden" {/neq}>
                                &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
                                &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
                                {$Klass->name}
                                <input type="checkbox" id="klass" value="{$Klass->id}" name="ids[{$key}]"  {neq name="$Klass->grade_id" value="$Grade->id" } hidden="hidden" {/neq}>
                            </div><br>
                            {/volist}
                        </div>
                    </div>
                    {/volist}
                </div>
            </div>
            {/volist}
        </div>
        {/volist}
    </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <button type="submit" class="btn btn-primary">确定</button>
                </div>
            </div>
        </div>
    </div>
</form>

<script>
    //onchang的方法完成级联表单操作
    function getMajor() {
        var major1      = document.getElementById('major1').innerHTML;
        var collegeNode = document.getElementById('college');
        var majorNode   = document.getElementById('major');
        var name = "aCollege";//建立的input的name

        clear(majorNode);

        var collegeIndex = collegeNode.selectedIndex;
        var value = collegeNode[collegeIndex].value;
        var url = "/labmanagesystem/public/index/teacher/getMajor?college="+value;
        ajaxGet(url, function (response) {
            var majors = response;
            createOption(majorNode,majors);
            setSelected(majorNode,major1);
        });
        creatInput(value,name,collegeNode);
    }
    function getGrade() {
        var grade1      = document.getElementById('grade1').innerHTML;
        var majorNode = document.getElementById('major');
        var gradeNode   = document.getElementById('grade');
        var name = "aMajor";//建立的input的name

        clear(gradeNode);

        var majorIndex = majorNode.selectedIndex;
        var value = majorNode[majorIndex].value;
        var url = "/labmanagesystem/public/index/teacher/getGrade?major="+value;
        ajaxGet(url, function (response) {
            var grades = response;
            createOption(gradeNode,grades);
            setSelected(gradeNode,grade1);
        });
        creatInput(value,name,majorNode);
    }
    function getKlass() {
        var klass1      = document.getElementById('klass1').innerHTML;
        var gradeNode = document.getElementById('grade');
        var klassNode   = document.getElementById('aklass');
        var name = "aGrade";//建立的input的name

        clear(klassNode);

        var gradeIndex = gradeNode.selectedIndex;
        var value = gradeNode[gradeIndex].value;
        var url = "/labmanagesystem/public/index/teacher/getKlass?grade="+value;
        ajaxGet(url, function (response) {
            var klasses = response;
            createOption(klassNode,klasses);
            setSelected(klassNode,klass1);
        });
        creatInput(value,name,gradeNode);
    }
    function getKlassId() {
        var klassNode = document.getElementById('aklass');
        var klassIndex = klassNode.selectedIndex;
        var klassId = klassNode[klassIndex].value;
        var name = "aKlass"//建立的input的name

        creatInput(klassId,name,klassNode);
    }

    //访问php函数，一个对象数组的返回值
    function ajaxGet(url, callback) {
        $.ajax({
            url: url,
            type: "get",
            success: function(response) {
                callback(response);
            },
            error: function(xhr) {
                console.log('server error');
            }
        });
    }

    //清除
    function clear(node) {
        node.length = 0;
    }

    //创建选项
    function createOption(node, inners, values) {
        for (var i = 0; i < inners.length; i++) {
            var option = document.createElement('option');

            option.value = inners[i].id;
            option.name = node;
            option.innerHTML = inners[i].name;
            node.appendChild(option);
        }
    }

    //设置选中状态
    function setSelected(node, value) {
        for (var i = 0; i < node.options.length; i++) {
            if (node.options[i].innerHTML == value) {
                node.options[i].setAttribute("selected", "true");
            }
        }
    }

    //创建一个input按钮
    function creatInput(value,name,position) {
         var newInput = document.createElement("input");
         newInput.name = name;
         newInput.value = value;
         position.appendChild(newInput);
    }

</script>
{/block}